‚úÖ MEMENTO ‚Äì LOADER & ANALYSIS FIX REPORT (FOR REPLIT)

Context:
I‚Äôm finalizing the MVP for Memento, a universal agent trace viewer/debugger.
I tested all canonical traces across 3 formats (LangChain, LangGraph-like, generic arrays).
Most of the pipeline works, but a few core issues remain before I can put this in front of early adopters (real agent engineers).

Below is everything that still needs fixing.

‚∏ª

1. FORMAT DETECTION ‚Äì PRIORITY ORDER IS WRONG

Some traces are being classified as generic even when they contain clear LangChain structure.

Example:
	‚Ä¢	Simple LangChain weather trace (with intermediate_steps) loads as generic.
	‚Ä¢	Expected: detect LangChain ‚Üí map nodes accordingly ‚Üí then render.

Required fix:
Implement strict detection priority:

1. LangGraph (flow, nodes, edges)
2. LangChain (intermediate_steps or structured tool_calls)
3. Array traces (list of steps)
4. Generic fallback

Right now ‚Äúgeneric‚Äù wins too often.

‚∏ª

2. NODE TYPE NORMALIZATION IS INCONSISTENT

Across different formats, identical concepts map to different internal node types.
This breaks detection, risk scoring, and trace comparisons.

Examples:
	‚Ä¢	Actions sometimes render as action (correct), sometimes as a plain step.
	‚Ä¢	Final answers from LangChain sometimes load as thought instead of output.
	‚Ä¢	Array traces inconsistently decide between observation and action_output.

Required fix:
Add a normalization layer after parsing:

if step indicates reasoning / chain-of-thought ‚Üí "thought"
if step calls a tool or external function ‚Üí "action"
if step returns structured data ‚Üí "observation"
if step is final AI output ‚Üí "output"

This must be deterministic across all loaders.

‚∏ª

3. RISK SCORING IS INCONSISTENT

Same type of problem gives different risk levels depending on format.

Examples:
	‚Ä¢	1 timeout error ‚Üí sometimes Medium, sometimes High.
	‚Ä¢	Missing final output ‚Üí still labeled Low risk (should never be Low).
	‚Ä¢	Suspicious transitions in generic traces fire correctly, but LangChain traces with incomplete reasoning steps don‚Äôt trigger warnings.

Required fix:
Risk model should be:

Low
	‚Ä¢	No errors
	‚Ä¢	No missing required nodes
	‚Ä¢	No suspicious transitions

Medium
	‚Ä¢	Exactly 1 error
	‚Ä¢	OR suspicious transition

High
	‚Ä¢	2+ errors
	‚Ä¢	OR missing critical nodes:
	‚Ä¢	action without observation
	‚Ä¢	missing final output
	‚Ä¢	abnormal node jumps

And this logic must apply identically across all loaders.

‚∏ª

4. ERRORS GET DOUBLE-COUNTED IN ARRAY TRACES

In some array traces:
	‚Ä¢	The observation node carries the error
	‚Ä¢	The final ‚Äúresult‚Äù is also flagged as error

‚Üí Risk scoring then counts two errors when it should be one.

Example:
Bank transfer trace shows 2 errors detected even though this is a single propagation of the same error.

Required fix:
Implement error deduplication:
	‚Ä¢	If multiple nodes reference the same underlying error / message / exception ‚Üí count it once.

‚∏ª

5. GENERIC LOADER IS TOO PERMISSIVE

Some traces that should trigger warnings render cleanly with no issues.

Example:
Weather trace with step ‚Üí action ‚Üí observation ‚Üí action ‚Üí observation‚Ä¶
If the final output is missing, this should not be Low risk.

Required fix:
Generic loader must enforce structure checks similar to the others:
	‚Ä¢	An action must be followed by an observation
	‚Ä¢	A final answer must be present
	‚Ä¢	Repeated reasoning loops should be flagged

Currently it fails silently.

‚∏ª

6. COMPARE MODE WORKS, BUT NODE ALIGNMENT IS SOMETIMES OFF

Comparing array vs generic traces works, but when formats differ:
	‚Ä¢	Node count mismatches cause misalignment
	‚Ä¢	Node type normalization (see #2) will fix 90% of this

‚∏ª

7. Small UI/UX consistency issues

Not critical, but worth fixing:
	‚Ä¢	Some nodes show their _globalIndex when others hide internal metadata
	‚Ä¢	Suspicious transition badge sometimes appears on the wrong side of the node
	‚Ä¢	Risk icon colors shift slightly between formats

‚∏ª

üìå Summary: What‚Äôs working well

To be fair:
	‚Ä¢	All formats load
	‚Ä¢	Compare mode works
	‚Ä¢	Replay works
	‚Ä¢	Suspicious transitions fire
	‚Ä¢	Errors are detected
	‚Ä¢	Parsing is stable

The MVP is close ‚Äî the pieces are there, they just need to behave consistently.

‚∏ª

üéØ Priority Fix Order

If you want the MVP to feel production-ready:
	1.	Fix Loader Priority (most important)
	2.	Normalize Node Types
	3.	Stabilize Risk Scoring
	4.	Deduplicate Errors
	5.	Generic Loader Structure Rules

Once these 5 are done, I can confidently onboard the first engineers.

